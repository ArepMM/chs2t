#include "dc-motor-fan.h"

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
DCMotorFan::DCMotorFan(QObject* parent) : Device(parent)
  , U(0.0)
  , Un(0.0)
  , In(0.0)
  , Nn(0.0)
  , Pn(0.0)
  , R(0.0)
  , E(0.0)
  , omega_nom(0.0)
  , omega(0.0)
{

}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
DCMotorFan::~DCMotorFan()
{

}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
void DCMotorFan::preStep(state_vector_t& Y, double t)
{

}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
void DCMotorFan::ode_system(const state_vector_t& Y, state_vector_t& dYdt, double t)
{
    dYdt[0] = (U - Y[0] * calcCPhi(In)) / R * calcCPhi(In) - sign(Y[0]);
    omega = Y[0];
}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
void DCMotorFan::load_config(CfgReader& cfg)
{
    QString secName = "Device";

    cfg.getDouble(secName, "Un", Un);
    cfg.getDouble(secName, "In", In);
    cfg.getDouble(secName, "Nn", Nn);
    cfg.getDouble(secName, "Pn", Pn);
    cfg.getDouble(secName, "R", R);
    cfg.getDouble(secName, "omega_nom", omega_nom);
}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
double DCMotorFan::calcCPhi(double I)
{
    return 1.23 * cPhi.getValue(I);
}
